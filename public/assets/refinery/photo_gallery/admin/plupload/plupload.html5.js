!function(e,t,n,s){function r(t,i){var n;return"FileReader"in e?(n=new FileReader,n.readAsDataURL(t),n.onload=function(){i(n.result)},void 0):i(t.getAsDataURL())}function a(t,i){var n;return"FileReader"in e?(n=new FileReader,n.readAsBinaryString(t),n.onload=function(){i(n.result)},void 0):i(t.getAsBinary())}function o(e,i,n,s){var a,o,l,c,p=this;r(h[e.id],function(r){a=t.createElement("canvas"),a.style.display="none",t.body.appendChild(a),o=a.getContext("2d"),l=new Image,l.onerror=l.onabort=function(){s({success:!1})},l.onload=function(){var t,h,f,g;if(i.width||(i.width=l.width),i.height||(i.height=l.height),c=Math.min(i.width/l.width,i.height/l.height),1>c||1===c&&"image/jpeg"===n){if(t=Math.round(l.width*c),h=Math.round(l.height*c),a.width=t,a.height=h,o.drawImage(l,0,0,t,h),"image/jpeg"===n){if(f=new u(atob(r.substring(r.indexOf("base64,")+7))),f.headers&&f.headers.length&&(g=new d,g.init(f.get("exif")[0])&&(g.setExif("PixelXDimension",t),g.setExif("PixelYDimension",h),f.set("exif",g.getBinary()),p.hasEventListener("ExifData")&&p.trigger("ExifData",e,g.EXIF()),p.hasEventListener("GpsData")&&p.trigger("GpsData",e,g.GPS()))),i.quality)try{r=a.toDataURL(n,i.quality/100)}catch(m){r=a.toDataURL(n)}}else r=a.toDataURL(n);r=r.substring(r.indexOf("base64,")+7),r=atob(r),f&&f.headers&&f.headers.length&&(r=f.restore(r),f.purge()),a.parentNode.removeChild(a),s({success:!0,data:r})}else s({success:!1})},l.src=r})}function l(){function e(e,t){var i,s=r?0:-8*(t-1),a=0;for(i=0;t>i;i++)a|=n.charCodeAt(e+i)<<Math.abs(s+8*i);return a}function t(e,t,i){var i=3===arguments.length?i:n.length-t-1;n=n.substr(0,t)+e+n.substr(i+t)}function i(e,i,n){var s,a="",o=r?0:-8*(n-1);for(s=0;n>s;s++)a+=String.fromCharCode(255&i>>Math.abs(o+8*s));t(a,e,n)}var n,r=!1;return{II:function(e){return e===s?r:(r=e,void 0)},init:function(e){r=!1,n=e},SEGMENT:function(e,i,s){switch(arguments.length){case 1:return n.substr(e,n.length-e-1);case 2:return n.substr(e,i);case 3:t(s,e,i);break;default:return n}},BYTE:function(t){return e(t,1)},SHORT:function(t){return e(t,2)},LONG:function(t,n){return n===s?e(t,4):(i(t,n,4),void 0)},SLONG:function(t){var i=e(t,4);return i>2147483647?i-4294967296:i},STRING:function(t,i){var n="";for(i+=t;i>t;t++)n+=String.fromCharCode(e(t,1));return n}}}function u(e){var t,i,n,r={65505:{app:"EXIF",name:"APP1",signature:"Exif\x00"},65506:{app:"ICC",name:"APP2",signature:"ICC_PROFILE\x00"},65517:{app:"IPTC",name:"APP13",signature:"Photoshop 3.0\x00"}},a=[],o=s,d=0;if(t=new l,t.init(e),65496===t.SHORT(0)){for(i=2,n=Math.min(1048576,e.length);n>=i;)if(o=t.SHORT(i),o>=65488&&65495>=o)i+=2;else{if(65498===o||65497===o)break;d=t.SHORT(i+2)+2,r[o]&&t.STRING(i+4,r[o].signature.length)===r[o].signature&&a.push({hex:o,app:r[o].app.toUpperCase(),name:r[o].name.toUpperCase(),start:i,length:d,segment:t.SEGMENT(i,d)}),i+=d}return t.init(null),{headers:a,restore:function(e){t.init(e);var n=new u(e);if(!n.headers)return!1;for(var s=n.headers.length;s>0;s--){var r=n.headers[s-1];t.SEGMENT(r.start,r.length,"")}n.purge(),i=65504==t.SHORT(2)?4+t.SHORT(4):2;for(var s=0,o=a.length;o>s;s++)t.SEGMENT(i,0,a[s].segment),i+=a[s].length;return t.SEGMENT()},get:function(e){for(var t=[],i=0,n=a.length;n>i;i++)a[i].app===e.toUpperCase()&&t.push(a[i].segment);return t},set:function(e,t){var i=[];"string"==typeof t?i.push(t):i=t;for(var n=ii=0,s=a.length;s>n&&(a[n].app===e.toUpperCase()&&(a[n].segment=i[ii],a[n].length=i[ii].length,ii++),!(ii>=i.length));n++);},purge:function(){a=[],t.init(null)}}}}function d(){function e(e,t){var i,n,r,o,l,c,h,p,f=a.SHORT(e),g=[],m={};for(i=0;f>i;i++)if(h=c=e+12*i+2,r=t[a.SHORT(h)],r!==s){switch(o=a.SHORT(h+=2),l=a.LONG(h+=2),h+=4,g=[],o){case 1:case 7:for(l>4&&(h=a.LONG(h)+d.tiffHeader),n=0;l>n;n++)g[n]=a.BYTE(h+n);break;case 2:l>4&&(h=a.LONG(h)+d.tiffHeader),m[r]=a.STRING(h,l-1);continue;case 3:for(l>2&&(h=a.LONG(h)+d.tiffHeader),n=0;l>n;n++)g[n]=a.SHORT(h+2*n);break;case 4:for(l>1&&(h=a.LONG(h)+d.tiffHeader),n=0;l>n;n++)g[n]=a.LONG(h+4*n);break;case 5:for(h=a.LONG(h)+d.tiffHeader,n=0;l>n;n++)g[n]=a.LONG(h+4*n)/a.LONG(h+4*n+4);break;case 9:for(h=a.LONG(h)+d.tiffHeader,n=0;l>n;n++)g[n]=a.SLONG(h+4*n);break;case 10:for(h=a.LONG(h)+d.tiffHeader,n=0;l>n;n++)g[n]=a.SLONG(h+4*n)/a.SLONG(h+4*n+4);break;default:continue}p=1==l?g[0]:g,m[r]=u.hasOwnProperty(r)&&"object"!=typeof p?u[r][p]:p}return m}function t(){var t=s,i=d.tiffHeader;return a.II(18761==a.SHORT(i)),42!==a.SHORT(i+=2)?!1:(d.IFD0=d.tiffHeader+a.LONG(i+=2),t=e(d.IFD0,o.tiff),d.exifIFD="ExifIFDPointer"in t?d.tiffHeader+t.ExifIFDPointer:s,d.gpsIFD="GPSInfoIFDPointer"in t?d.tiffHeader+t.GPSInfoIFDPointer:s,!0)}function r(e,t,n){var s,r,l,u=0;if("string"==typeof t){var c=o[e.toLowerCase()];for(hex in c)if(c[hex]===t){t=hex;break}}for(s=d[e.toLowerCase()+"IFD"],r=a.SHORT(s),i=0;r>i;i++)if(l=s+12*i+2,a.SHORT(l)==t){u=l+8;break}return u?(a.LONG(u,n),!0):!1}var a,o,u,d={};return a=new l,o={tiff:{274:"Orientation",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer"},exif:{36864:"ExifVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",36867:"DateTimeOriginal",33434:"ExposureTime",33437:"FNumber",34855:"ISOSpeedRatings",37377:"ShutterSpeedValue",37378:"ApertureValue",37383:"MeteringMode",37384:"LightSource",37385:"Flash",41986:"ExposureMode",41987:"WhiteBalance",41990:"SceneCaptureType",41988:"DigitalZoomRatio",41992:"Contrast",41993:"Saturation",41994:"Sharpness"},gps:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude"}},u={ColorSpace:{1:"sRGB",0:"Uncalibrated"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{1:"Daylight",2:"Fliorescent",3:"Tungsten",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 -5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire.",1:"Flash fired.",5:"Strobe return light not detected.",7:"Strobe return light detected.",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},ExposureMode:{0:"Auto exposure",1:"Manual exposure",2:"Auto bracket"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},GPSLatitudeRef:{N:"North latitude",S:"South latitude"},GPSLongitudeRef:{E:"East longitude",W:"West longitude"}},{init:function(e){return d={tiffHeader:10},e!==s&&e.length?(a.init(e),65505===a.SHORT(0)&&"EXIF\x00"===a.STRING(4,5).toUpperCase()?t():!1):!1},EXIF:function(){var t;if(t=e(d.exifIFD,o.exif),t.ExifVersion&&"array"===n.typeOf(t.ExifVersion)){for(var i=0,s="";i<t.ExifVersion.length;i++)s+=String.fromCharCode(t.ExifVersion[i]);t.ExifVersion=s}return t},GPS:function(){var t;return t=e(d.gpsIFD,o.gps),t.GPSVersionID&&(t.GPSVersionID=t.GPSVersionID.join(".")),t},setExif:function(e,t){return"PixelXDimension"!==e&&"PixelYDimension"!==e?!1:r("exif",e,t)},getBinary:function(){return a.SEGMENT()}}}var c,h={};n.runtimes.Html5=n.addRuntime("html5",{getFeatures:function(){var i,s,r,a,o,l;return s=r=o=l=!1,e.XMLHttpRequest&&(i=new XMLHttpRequest,r=!!i.upload,s=!(!i.sendAsBinary&&!i.upload)),s&&(a=!!(i.sendAsBinary||e.Uint8Array&&e.ArrayBuffer),o=!(!File||!File.prototype.getAsDataURL&&!e.FileReader||!a),l=!(!File||!(File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice))),c=n.ua.safari&&n.ua.windows,{html5:s,dragdrop:function(){var e=t.createElement("div");return"draggable"in e||"ondragstart"in e&&"ondrop"in e}(),jpgresize:o,pngresize:o,multipart:o||!!e.FileReader||!!e.FormData,canSendBinary:a,cantSendBlobInFormData:!(!(n.ua.gecko&&e.FormData&&e.FileReader)||FileReader.prototype.readAsArrayBuffer),progress:r,chunks:l,multi_selection:!(n.ua.safari&&n.ua.windows),triggerDialog:n.ua.gecko&&e.FormData||n.ua.webkit}},init:function(i,s){function r(e){var t,s,r,a=[],o={};for(s=0;s<e.length;s++)t=e[s],o[t.name]||(o[t.name]=!0,r=n.guid(),h[r]=t,a.push(new n.File(r,t.fileName||t.name,t.fileSize||t.size)));a.length&&i.trigger("FilesAdded",a)}var l,u;return l=this.getFeatures(),l.html5?(i.bind("Init",function(e){var s,a,o,l,u,d,c,h=[],p=e.settings.filters,f=t.body;s=t.createElement("div"),s.id=e.id+"_html5_container",n.extend(s.style,{position:"absolute",background:i.settings.shim_bgcolor||"transparent",width:"100px",height:"100px",overflow:"hidden",zIndex:99999,opacity:i.settings.shim_bgcolor?"":0}),s.className="plupload html5",i.settings.container&&(f=t.getElementById(i.settings.container),"static"===n.getStyle(f,"position")&&(f.style.position="relative")),f.appendChild(s);e:for(o=0;o<p.length;o++)for(u=p[o].extensions.split(/,/),l=0;l<u.length;l++){if("*"===u[l]){h=[];break e}d=n.mimeTypes[u[l]],d&&-1===n.inArray(d,h)&&h.push(d)}if(s.innerHTML='<input id="'+i.id+'_html5"  style="font-size:999px" type="file" '+(i.settings.multi_selection&&i.features.multi_selection?'multiple="multiple"':"")+" />",s.scrollTop=100,c=t.getElementById(i.id+"_html5"),e.features.triggerDialog?n.extend(c.style,{position:"absolute",width:"100%",height:"100%"}):n.extend(c.style,{cssFloat:"right",styleFloat:"right"}),c.onchange=function(){r(this.files),this.value=""},a=t.getElementById(e.settings.browse_button)){var g=e.settings.browse_button_hover,m=e.settings.browse_button_active,v=e.features.triggerDialog?a:s;g&&(n.addEvent(v,"mouseover",function(){n.addClass(a,g)},e.id),n.addEvent(v,"mouseout",function(){n.removeClass(a,g)},e.id)),m&&(n.addEvent(v,"mousedown",function(){n.addClass(a,m)},e.id),n.addEvent(t.body,"mouseup",function(){n.removeClass(a,m)},e.id)),e.features.triggerDialog&&n.addEvent(a,"click",function(i){var n=t.getElementById(e.id+"_html5");n&&!n.disabled&&n.click(),i.preventDefault()},e.id)}}),i.bind("PostInit",function(){var e=t.getElementById(i.settings.drop_element);if(e){if(c)return n.addEvent(e,"dragenter",function(){var s,a,o;s=t.getElementById(i.id+"_drop"),s||(s=t.createElement("input"),s.setAttribute("type","file"),s.setAttribute("id",i.id+"_drop"),s.setAttribute("multiple","multiple"),n.addEvent(s,"change",function(){r(this.files),n.removeEvent(s,"change",i.id),s.parentNode.removeChild(s)},i.id),e.appendChild(s)),a=n.getPos(e,t.getElementById(i.settings.container)),o=n.getSize(e),"static"===n.getStyle(e,"position")&&n.extend(e.style,{position:"relative"}),n.extend(s.style,{position:"absolute",display:"block",top:0,left:0,width:o.w+"px",height:o.h+"px",opacity:0})},i.id),void 0;n.addEvent(e,"dragover",function(e){e.preventDefault()},i.id),n.addEvent(e,"drop",function(e){var t=e.dataTransfer;t&&t.files&&r(t.files),e.preventDefault()},i.id)}}),i.bind("Refresh",function(e){var s,r,a,o,l;s=t.getElementById(i.settings.browse_button),s&&(r=n.getPos(s,t.getElementById(e.settings.container)),a=n.getSize(s),o=t.getElementById(i.id+"_html5_container"),n.extend(o.style,{top:r.y+"px",left:r.x+"px",width:a.w+"px",height:a.h+"px"}),i.features.triggerDialog&&("static"===n.getStyle(s,"position")&&n.extend(s.style,{position:"relative"}),l=parseInt(n.getStyle(s,"z-index"),10),isNaN(l)&&(l=0),n.extend(s.style,{zIndex:l}),n.extend(o.style,{zIndex:l-1})))}),i.bind("DisableBrowse",function(e,i){var n=t.getElementById(e.id+"_html5");n&&(n.disabled=i)}),i.bind("CancelUpload",function(){u&&u.abort&&u.abort()}),i.bind("UploadFile",function(t,i){function s(e,t,i){var n;if(!File.prototype.slice)return(n=File.prototype.webkitSlice||File.prototype.mozSlice)?n.call(e,t,i):null;try{return e.slice(),e.slice(t,i)}catch(s){return e.slice(t,i-t)}}function r(r){function a(){function p(s){var r,c=0,h="----pluploadboundary"+n.guid(),p="--",w="\r\n",x="";if(u=new XMLHttpRequest,u.upload&&(u.upload.onprogress=function(e){i.loaded=Math.min(i.size,d+e.loaded-c),t.trigger("UploadProgress",i)}),u.onreadystatechange=function(){var e,l;if(4==u.readyState&&t.state!==n.STOPPED){try{e=u.status}catch(c){e=0}if(e>=400)t.trigger("Error",{code:n.HTTP_ERROR,message:n.translate("HTTP Error."),file:i,status:e});else{if(g){if(l={chunk:o,chunks:g,response:u.responseText,status:e},t.trigger("ChunkUploaded",i,l),d+=b,l.cancelled)return i.status=n.FAILED,void 0;i.loaded=Math.min(i.size,(o+1)*v)}else i.loaded=i.size;t.trigger("UploadProgress",i),s=f=r=x=null,!g||++o>=g?(i.status=n.DONE,t.trigger("FileUploaded",i,{response:u.responseText,status:e})):a()}}},t.settings.multipart&&l.multipart){if(m.name=i.target_name||i.name,u.open("post",_,!0),n.each(t.settings.headers,function(e,t){u.setRequestHeader(t,e)}),"string"!=typeof s&&e.FormData)return r=new FormData,n.each(n.extend(m,t.settings.multipart_params),function(e,t){r.append(t,e)}),r.append(t.settings.file_data_name,s),u.send(r),void 0;if("string"==typeof s){if(u.setRequestHeader("Content-Type","multipart/form-data; boundary="+h),n.each(n.extend(m,t.settings.multipart_params),function(e,t){x+=p+h+w+'Content-Disposition: form-data; name="'+t+'"'+w+w,x+=unescape(encodeURIComponent(e))+w}),y=n.mimeTypes[i.name.replace(/^.+\.([^.]+)/,"$1").toLowerCase()]||"application/octet-stream",x+=p+h+w+'Content-Disposition: form-data; name="'+t.settings.file_data_name+'"; filename="'+unescape(encodeURIComponent(i.name))+'"'+w+"Content-Type: "+y+w+w+s+w+p+h+p+w,c=x.length-s.length,s=x,u.sendAsBinary)u.sendAsBinary(s);else if(l.canSendBinary){for(var k=new Uint8Array(s.length),S=0;S<s.length;S++)k[S]=255&s.charCodeAt(S);u.send(k.buffer)}return}}_=n.buildUrl(t.settings.url,n.extend(m,t.settings.multipart_params)),u.open("post",_,!0),u.setRequestHeader("Content-Type","application/octet-stream"),n.each(t.settings.headers,function(e,t){u.setRequestHeader(t,e)}),u.send(s)}var f,g,m,v,b,y,_=t.settings.url;i.status!=n.DONE&&i.status!=n.FAILED&&t.state!=n.STOPPED&&(m={name:i.target_name||i.name},c.chunk_size&&i.size>c.chunk_size&&(l.chunks||"string"==typeof r)?(v=c.chunk_size,g=Math.ceil(i.size/v),b=Math.min(v,i.size-o*v),f="string"==typeof r?r.substring(o*v,o*v+b):s(r,o*v,o*v+b),m.chunk=o,m.chunks=g):(b=i.size,f=r),t.settings.multipart&&l.multipart&&"string"!=typeof f&&h&&l.cantSendBlobInFormData&&l.chunks&&t.settings.chunk_size?(h.onload=function(){p(h.result)},h.readAsBinaryString(f)):p(f))}var o=0,d=0,h="FileReader"in e?new FileReader:null;a()}var d,c=t.settings;d=h[i.id],l.jpgresize&&t.settings.resize&&/\.(png|jpg|jpeg)$/i.test(i.name)?o.call(t,i,t.settings.resize,/\.png$/i.test(i.name)?"image/png":"image/jpeg",function(e){e.success?(i.size=e.data.length,r(e.data)):l.chunks?r(d):a(d,r)}):!l.chunks&&l.jpgresize?a(d,r):r(d)}),i.bind("Destroy",function(e){var i,s,r=t.body,a={inputContainer:e.id+"_html5_container",inputFile:e.id+"_html5",browseButton:e.settings.browse_button,dropElm:e.settings.drop_element};for(i in a)s=t.getElementById(a[i]),s&&n.removeAllEvents(s,e.id);n.removeAllEvents(t.body,e.id),e.settings.container&&(r=t.getElementById(e.settings.container)),r.removeChild(t.getElementById(a.inputContainer))}),s({success:!0}),void 0):(s({success:!1}),void 0)}})}(window,document,plupload);