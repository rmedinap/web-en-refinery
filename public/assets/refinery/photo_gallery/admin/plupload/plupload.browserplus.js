!function(e){e.runtimes.BrowserPlus=e.addRuntime("browserplus",{getFeatures:function(){return{dragdrop:!0,jpgresize:!0,pngresize:!0,chunks:!0,progress:!0,multipart:!0,multi_selection:!0}},init:function(t,i){function n(i){var n,s,a,r=[];for(n=0;n<i.length;n++)s=i[n],a=e.guid(),o[a]=s,r.push(new e.File(a,s.name,s.size));n&&t.trigger("FilesAdded",r)}function s(){var s=!1;t.bind("PostInit",function(){function i(e,t){a.DragAndDrop.AddDropTarget({id:e},function(){a.DragAndDrop.AttachCallbacks({id:e,hover:function(e){!e&&t&&t()},drop:function(e){t&&t(),n(e)}},function(){})})}function o(){document.getElementById(c).style.top="-1000px"}var l,h=r.drop_element,c=t.id+"_droptarget",u=document.getElementById(h);u&&(document.attachEvent&&/MSIE/gi.test(navigator.userAgent)?(l=document.createElement("div"),l.setAttribute("id",c),e.extend(l.style,{position:"absolute",top:"-1000px",background:"red",filter:"alpha(opacity=0)",opacity:0}),document.body.appendChild(l),e.addEvent(u,"dragenter",function(){var t,i;t=document.getElementById(h),i=e.getPos(t),e.extend(document.getElementById(c).style,{top:i.y+"px",left:i.x+"px",width:t.offsetWidth+"px",height:t.offsetHeight+"px"})}),i(c,o)):i(h)),e.addEvent(document.getElementById(r.browse_button),"click",function(t){var i,o,l,h,c=[],u=r.filters;if(t.preventDefault(),!s){e:for(i=0;i<u.length;i++)for(l=u[i].extensions.split(","),o=0;o<l.length;o++){if("*"===l[o]){c=[];break e}h=e.mimeTypes[l[o]],h&&-1===e.inArray(h,c)&&c.push(e.mimeTypes[l[o]])}a.FileBrowse.OpenBrowseDialog({mimeTypes:c},function(e){e.success&&n(e.value)})}}),u=l=null}),t.bind("CancelUpload",function(){a.Uploader.cancel({},function(){})}),t.bind("DisableBrowse",function(e,t){s=t}),t.bind("UploadFile",function(t,i){function n(s,o){var l;i.status!=e.FAILED&&(c.name=i.target_name||i.name,u&&(c.chunk=""+s,c.chunks=""+o),l=d.shift(),a.Uploader.upload({url:t.settings.url,files:{file:l},cookies:document.cookies,postvars:e.extend(c,t.settings.multipart_params),progressCallback:function(e){var n,a=0;for(r[s]=parseInt(e.filePercent*l.size/100,10),n=0;n<r.length;n++)a+=r[n];i.loaded=a,t.trigger("UploadProgress",i)}},function(a){var r;a.success?(r=a.value.statusCode,u&&t.trigger("ChunkUploaded",i,{chunk:s,chunks:o,response:a.value.body,status:r}),d.length>0?n(++s,o):(i.status=e.DONE,t.trigger("FileUploaded",i,{response:a.value.body,status:r}),r>=400&&t.trigger("Error",{code:e.HTTP_ERROR,message:e.translate("HTTP Error."),file:i,status:r}))):t.trigger("Error",{code:e.GENERIC_ERROR,message:e.translate("Generic Error."),file:i,details:a.error})}))}function s(e){i.size=e.size,u?a.FileAccess.chunk({file:e,chunkSize:u},function(e){if(e.success){var t=e.value,i=t.length;r=Array(i);for(var s=0;i>s;s++)r[s]=0,d.push(t[s]);n(0,i)}}):(r=Array(1),d.push(e),n(0,1))}var r,h=o[i.id],c={},u=t.settings.chunk_size,d=[];l&&/\.(png|jpg|jpeg)$/i.test(i.name)?BrowserPlus.ImageAlter.transform({file:h,quality:l.quality||90,actions:[{scale:{maxwidth:l.width,maxheight:l.height}}]},function(e){e.success&&s(e.value.file)}):s(h)}),i({success:!0})}var a=window.BrowserPlus,o={},r=t.settings,l=r.resize;a?a.init(function(e){var t=[{service:"Uploader",version:"3"},{service:"DragAndDrop",version:"1"},{service:"FileBrowse",version:"1"},{service:"FileAccess",version:"2"}];l&&t.push({service:"ImageAlter",version:"4"}),e.success?a.require({services:t},function(e){e.success?s():i()}):i()}):i()}})}(plupload);