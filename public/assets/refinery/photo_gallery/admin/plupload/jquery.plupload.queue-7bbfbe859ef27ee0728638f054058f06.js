!function(e){function t(e){return plupload.translate(e)||e}function i(i,n){n.contents().each(function(t,i){i=e(i),i.is(".plupload")||i.remove()}),n.prepend('<div class="plupload_wrapper plupload_scroll"><div id="'+i+'_container" class="plupload_container"><div class="plupload"><div class="plupload_header"><div class="plupload_header_content"><div class="plupload_header_title">'+t("Select files")+'</div><div class="plupload_header_text">'+t("Add files to the upload queue and click the start button.")+'</div></div></div><div class="plupload_content"><div class="plupload_filelist_header"><div class="plupload_file_name">'+t("Filename")+'</div><div class="plupload_file_action">&nbsp;</div><div class="plupload_file_status"><span>'+t("Status")+'</span></div><div class="plupload_file_size">'+t("Size")+'</div><div class="plupload_clearer">&nbsp;</div></div><ul id="'+i+'_filelist" class="plupload_filelist"></ul><div class="plupload_filelist_footer"><div class="plupload_file_name"><div class="plupload_buttons"><a href="#" class="plupload_button plupload_add">'+t("Add files")+'</a><a href="#" class="plupload_button plupload_start">'+t("Start upload")+'</a></div><span class="plupload_upload_status"></span></div><div class="plupload_file_action"></div><div class="plupload_file_status"><span class="plupload_total_status">0%</span></div><div class="plupload_file_size"><span class="plupload_total_file_size">0 b</span></div><div class="plupload_progress"><div class="plupload_progress_container"><div class="plupload_progress_bar"></div></div></div><div class="plupload_clearer">&nbsp;</div></div></div></div></div><input type="hidden" id="'+i+'_count" name="'+i+'_count" value="0" /></div>')}var n={};e.fn.pluploadQueue=function(s){return s?(this.each(function(){function a(t){var i;t.status==plupload.DONE&&(i="plupload_done"),t.status==plupload.FAILED&&(i="plupload_failed"),t.status==plupload.QUEUED&&(i="plupload_delete"),t.status==plupload.UPLOADING&&(i="plupload_uploading");var n=e("#"+t.id).attr("class",i).find("a").css("display","block");t.hint&&n.attr("title",t.hint)}function o(){e("span.plupload_total_status",h).html(l.total.percent+"%"),e("div.plupload_progress_bar",h).css("width",l.total.percent+"%"),e("span.plupload_upload_status",h).text(t("Uploaded %d/%d files").replace(/%d\/%d/,l.total.uploaded+"/"+l.files.length))}function r(){var i,n=e("ul.plupload_filelist",h).html(""),s=0;e.each(l.files,function(t,o){i="",o.status==plupload.DONE&&(o.target_name&&(i+='<input type="hidden" name="'+c+"_"+s+'_tmpname" value="'+plupload.xmlEncode(o.target_name)+'" />'),i+='<input type="hidden" name="'+c+"_"+s+'_name" value="'+plupload.xmlEncode(o.name)+'" />',i+='<input type="hidden" name="'+c+"_"+s+'_status" value="'+(o.status==plupload.DONE?"done":"failed")+'" />',s++,e("#"+c+"_count").val(s)),n.append('<li id="'+o.id+'"><div class="plupload_file_name"><span>'+o.name+'</span></div><div class="plupload_file_action"><a href="#"></a></div><div class="plupload_file_status">'+o.percent+'%</div><div class="plupload_file_size">'+plupload.formatSize(o.size)+'</div><div class="plupload_clearer">&nbsp;</div>'+i+"</li>"),a(o),e("#"+o.id+".plupload_delete a").click(function(t){e("#"+o.id).remove(),l.removeFile(o),t.preventDefault()})}),e("span.plupload_total_file_size",h).html(plupload.formatSize(l.total.size)),0===l.total.queued?e("span.plupload_add_text",h).text(t("Add files.")):e("span.plupload_add_text",h).text(l.total.queued+" files queued."),e("a.plupload_start",h).toggleClass("plupload_disabled",l.files.length==l.total.uploaded+l.total.failed),n[0].scrollTop=n[0].scrollHeight,o(),!l.files.length&&l.features.dragdrop&&l.settings.dragdrop&&e("#"+c+"_filelist").append('<li class="plupload_droptext">'+t("Drag files here.")+"</li>")}var l,h,c;h=e(this),c=h.attr("id"),c||(c=plupload.guid(),h.attr("id",c)),l=new plupload.Uploader(e.extend({dragdrop:!0,container:c},s)),n[c]=l,l.bind("UploadFile",function(t,i){e("#"+i.id).addClass("plupload_current_file")}),l.bind("Init",function(n,a){i(c,h),!s.unique_names&&s.rename&&e("#"+c+"_filelist div.plupload_file_name span",h).live("click",function(t){var i,s,a,o=e(t.target),r="";i=n.getFile(o.parents("li")[0].id),a=i.name,s=/^(.+)(\.[^.]+)$/.exec(a),s&&(a=s[1],r=s[2]),o.hide().after('<input type="text" />'),o.next().val(a).focus().blur(function(){o.show().next().remove()}).keydown(function(t){var n=e(this);13==t.keyCode&&(t.preventDefault(),i.name=n.val()+r,o.text(i.name),n.blur())})}),e("a.plupload_add",h).attr("id",c+"_browse"),n.settings.browse_button=c+"_browse",n.features.dragdrop&&n.settings.dragdrop&&(n.settings.drop_element=c+"_filelist",e("#"+c+"_filelist").append('<li class="plupload_droptext">'+t("Drag files here.")+"</li>")),e("#"+c+"_container").attr("title","Using runtime: "+a.runtime),e("a.plupload_start",h).click(function(t){e(this).hasClass("plupload_disabled")||l.start(),t.preventDefault()}),e("a.plupload_stop",h).click(function(e){e.preventDefault(),l.stop()}),e("a.plupload_start",h).addClass("plupload_disabled")}),l.init(),l.bind("Error",function(i,n){var s,a=n.file;a&&(s=n.message,n.details&&(s+=" ("+n.details+")"),n.code==plupload.FILE_SIZE_ERROR&&alert(t("Error: File too large: ")+a.name),n.code==plupload.FILE_EXTENSION_ERROR&&alert(t("Error: Invalid file extension: ")+a.name),a.hint=s,e("#"+a.id).attr("class","plupload_failed").find("a").css("display","block").attr("title",s))}),l.bind("StateChanged",function(){l.state===plupload.STARTED?(e("li.plupload_delete a,div.plupload_buttons",h).hide(),e("span.plupload_upload_status,div.plupload_progress,a.plupload_stop",h).css("display","block"),e("span.plupload_upload_status",h).text("Uploaded "+l.total.uploaded+"/"+l.files.length+" files"),s.multiple_queues&&e("span.plupload_total_status,span.plupload_total_file_size",h).show()):(r(),e("a.plupload_stop,div.plupload_progress",h).hide(),e("a.plupload_delete",h).css("display","block"))}),l.bind("QueueChanged",r),l.bind("FileUploaded",function(e,t){a(t)}),l.bind("UploadProgress",function(t,i){e("#"+i.id+" div.plupload_file_status",h).html(i.percent+"%"),a(i),o(),s.multiple_queues&&l.total.uploaded+l.total.failed==l.files.length&&(e(".plupload_buttons,.plupload_upload_status",h).css("display","inline"),e(".plupload_start",h).addClass("plupload_disabled"),e("span.plupload_total_status,span.plupload_total_file_size",h).hide())}),s.setup&&s.setup(l)}),this):n[e(this[0]).attr("id")]}}(jQuery);