!function(){if(!window.google||!google.gears){var e=null;if("undefined"!=typeof GearsFactory)e=new GearsFactory;else try{e=new ActiveXObject("Gears.Factory"),-1!=e.getBuildInfo().indexOf("ie_mobile")&&e.privateSetGlobalObject(this)}catch(t){"undefined"!=typeof navigator.mimeTypes&&navigator.mimeTypes["application/x-googlegears"]&&(e=document.createElement("object"),e.style.display="none",e.width=0,e.height=0,e.type="application/x-googlegears",document.documentElement.appendChild(e))}e&&(window.google||(window.google={}),google.gears||(google.gears={factory:e}))}}(),function(e,t,i){function n(e,t,i){var n,s;n=google.gears.factory.create("beta.canvas");try{if(n.decode(e),t.width||(t.width=n.width),t.height||(t.height=n.height),s=Math.min(width/n.width,height/n.height),1>s||1===s&&"image/jpeg"===i)return n.resize(Math.round(n.width*s),Math.round(n.height*s)),t.quality?n.encode(i,{quality:t.quality/100}):n.encode(i)}catch(a){}return e}var s={};i.runtimes.Gears=i.addRuntime("gears",{getFeatures:function(){return{dragdrop:!0,jpgresize:!0,pngresize:!0,chunks:!0,progress:!0,multipart:!0,multi_selection:!0}},init:function(a,r){function o(e){var t,n,r,o=[];for(n=0;n<e.length;n++)t=e[n],r=i.guid(),s[r]=t.blob,o.push(new i.File(r,t.name,t.blob.length));a.trigger("FilesAdded",o)}var l,u,c=!1;if(!e.google||!google.gears)return r({success:!1});try{l=google.gears.factory.create("beta.desktop")}catch(d){return r({success:!1})}a.bind("PostInit",function(){var e=a.settings,n=t.getElementById(e.drop_element);n&&(i.addEvent(n,"dragover",function(e){l.setDropEffect(e,"copy"),e.preventDefault()},a.id),i.addEvent(n,"drop",function(e){var t=l.getDragData(e,"application/x-gears-files");t&&o(t.files),e.preventDefault()},a.id),n=0),i.addEvent(t.getElementById(e.browse_button),"click",function(t){var i,n,s,a=[];if(t.preventDefault(),!c){e:for(i=0;i<e.filters.length;i++)for(s=e.filters[i].extensions.split(","),n=0;n<s.length;n++){if("*"===s[n]){a=[];break e}a.push("."+s[n])}l.openFiles(o,{singleFile:!e.multi_selection,filter:a})}},a.id)}),a.bind("CancelUpload",function(){u.abort&&u.abort()}),a.bind("UploadFile",function(e,t){function a(){function n(n){var s,a,r,o="----pluploadboundary"+i.guid(),l="--",c="\r\n";p&&(u.setRequestHeader("Content-Type","multipart/form-data; boundary="+o),s=google.gears.factory.create("beta.blobbuilder"),i.each(i.extend(g,e.settings.multipart_params),function(e,t){s.append(l+o+c+'Content-Disposition: form-data; name="'+t+'"'+c+c),s.append(e+c)}),r=i.mimeTypes[t.name.replace(/^.+\.([^.]+)/,"$1").toLowerCase()]||"application/octet-stream",s.append(l+o+c+'Content-Disposition: form-data; name="'+e.settings.file_data_name+'"; filename="'+t.name+'"'+c+"Content-Type: "+r+c+c),s.append(n),s.append(c+l+o+l+c),a=s.getAsBlob(),f=a.length-n.length,n=a),u.send(n)}var h,p=e.settings.multipart,f=0,g={name:t.target_name||t.name},m=e.settings.url;t.status!=i.DONE&&t.status!=i.FAILED&&e.state!=i.STOPPED&&(l&&(g.chunk=c,g.chunks=r),h=Math.min(o,t.size-c*o),p||(m=i.buildUrl(e.settings.url,g)),u=google.gears.factory.create("beta.httprequest"),u.open("POST",m),p||(u.setRequestHeader("Content-Disposition",'attachment; filename="'+t.name+'"'),u.setRequestHeader("Content-Type","application/octet-stream")),i.each(e.settings.headers,function(e,t){u.setRequestHeader(t,e)}),u.upload.onprogress=function(i){t.loaded=d+i.loaded-f,e.trigger("UploadProgress",t)},u.onreadystatechange=function(){var n;if(4==u.readyState&&e.state!==i.STOPPED)if(200==u.status){if(n={chunk:c,chunks:r,response:u.responseText,status:u.status},e.trigger("ChunkUploaded",t,n),n.cancelled)return t.status=i.FAILED,void 0;d+=h,++c>=r?(t.status=i.DONE,e.trigger("FileUploaded",t,{response:u.responseText,status:u.status})):a()}else e.trigger("Error",{code:i.HTTP_ERROR,message:i.translate("HTTP Error."),file:t,chunk:c,chunks:r,status:u.status})},r>c&&n(s[t.id].slice(c*o,h)))}var r,o,l,c=0,d=0,h=e.settings.resize;h&&/\.(png|jpg|jpeg)$/i.test(t.name)&&(s[t.id]=n(s[t.id],h,/\.png$/i.test(t.name)?"image/png":"image/jpeg")),t.size=s[t.id].length,o=e.settings.chunk_size,l=o>0,r=Math.ceil(t.size/o),l||(o=t.size,r=1),a()}),a.bind("DisableBrowse",function(e,t){c=t}),a.bind("Destroy",function(e){var n,s,a={browseButton:e.settings.browse_button,dropElm:e.settings.drop_element};for(n in a)s=t.getElementById(a[n]),s&&i.removeAllEvents(s,e.id)}),r({success:!0})}})}(window,document,plupload);